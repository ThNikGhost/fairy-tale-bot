import telebot
from langchain.schema import SystemMessage
from langchain_community.chat_models.gigachat import GigaChat
import threading
from AI.salutespeech import synthesize_speech
from AI.kandinsky import getImage
from bd import get_user_messages, update_user_messages

bot = telebot.TeleBot('7455623207:AAFxcMtvz9-srbJ7ycJfPJ38aFiE95as2Lo')
chat = GigaChat(credentials="OTg5ZWE3MzMtN2IyNS00ZGYyLWI3OTEtZWE4ZjQ0M2E2MzZmOjFjNzJkNzc5LWNkZjUtNGQyMi04Zjc0LTQ4Y2I2N2RjOTYxZA==", verify_ssl_certs=False)
previous_message = None
previous_user_request = None



def send_media(message, image_name, voice_file, text):
    bot.send_photo(message.chat.id, open(f"./fairy-tale/AI/photo/{image_name}", 'rb'))
    bot.send_audio(message.chat.id, open(f"./fairy-tale/AI/voices/{voice_file}", 'rb'))
    bot.send_message(message.chat.id, text)

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, '''–ü—Ä–∏–≤–µ—Ç! üëã
–Ø ‚Äî –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∫–∞–∑–∫—É –ø–æ —Ç–≤–æ–∏–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º. 
–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫–∞–∑–∫–∏, –Ω–∞–ø–∏—à–∏ –æ —á–µ–º —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞:''')
    bot.send_photo(message.chat.id, open('start.jpg', 'rb'))


@bot.message_handler(content_types=['text'])
def handle_text(message):
    global previous_message
    global previous_user_request
    user_request = message.text
    
    user_id = message.from_user.id
    user_data = get_user_messages(user_id)
    
    if user_data:
        previous_message = user_data[1]
        previous_user_request = user_data[2]
    
    if previous_message is not None and previous_user_request is not None:
        messages = [
            SystemMessage(
                content= """
                –¢—ã —Å–∫–∞–∑–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–µ—Ç–µ–π. –¢–µ–±–µ –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–º–µ—Å—Ç–µ —Å–æ –º–Ω–æ–π –≤ –≥–ª–∞–≤–Ω–æ–π —Ä–æ–ª–∏. –í –Ω–∞—á–∞–ª–µ —Å–ø—Ä–æ—Å–∏ –ø—Ä–æ —á—Ç–æ –±—É–¥–µ—Ç —Å–∫–∞–∑–∫–∞. –Ø –ø—Ä–∏—à–ª—é —Ç–µ–±–µ –∑–∞—Ç—Ä–∞–≤–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏. –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π –ø–æ 5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ —É—Ç–æ—á–Ω—è–π —É –º–µ–Ω—è "–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ?", —á—Ç–æ–±—ã —è –º–æ–≥ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Å–∫–∞–∑–∫–∏, –∏ –æ–Ω–∞ –±—ã–ª–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π, –∏ –∏–∑–º–µ–Ω—è–π –¥–∞–ª—å–Ω–µ–π—à—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —Å–∫–∞–∑–æ—á–Ω–æ–≥–æ —Å—Ç–∏–ª—è —Ä–∞—Å—Å–∫–∞–∑–∞. –°—é–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º –∏ –ª–æ–≥–∏—á–Ω—ã–º. –ò—Å—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –æ—Ç–≤–µ—á–∞—Ç—å –≤—Å–µ–º –ø—Ä–∞–≤–∏–ª–∞–º —Ü–µ–Ω–∑—É—Ä—ã, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–≤—Ä–µ–¥–∏—Ç—å —Ä–µ–±–µ–Ω–∫—É. –°—á–∏—Ç–∞–π –∏ –≤—ã–≤–æ–¥–∏ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ [–ß–∞—Å—Ç—å x], —Ö - –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏. –ü–æ—Å–ª–µ 5 —á–∞—Å—Ç–µ–π –∑–∞–≤–µ—Ä—à–∏ –∏—Å—Ç–æ—Ä–∏—é. –ó–∞–∫–æ–Ω—á–∏ –∏—Å—Ç–æ—Ä–∏—é —Å—á–∞—Å—Ç–ª–∏–≤—ã–º —Ñ–∏–Ω–∞–ª–æ–º, –≥–¥–µ –≥–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π –≤—ã–∂–∏–ª –∏ –ø–æ–±–µ–¥–∏–ª.

–ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Å—Ç–µ–π —Å–∫–∞–∑–∫–∏:
–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –ñ–∏–ª–∏-–±—ã–ª–∏ –≤ —Å—Ç–∞—Ä–∏–Ω–Ω–æ–º –ª–µ—Å—É —Ç—Ä–∏ –≤–µ—Å–µ–ª—ã—Ö –∑–∞–π—Ü–∞: –ë–∞—Ä–∞–±–∞—Å, –•–≤–æ—Å—Ç–∏–∫ –∏ –®—É—Å—Ç—Ä—ã–π. –û–Ω–∏ –±—ã–ª–∏ –Ω–µ—Ä–∞–∑–ª—É—á–Ω—ã–º–∏ –¥—Ä—É–∑—å—è–º–∏ –∏ –≤—Å–µ–≥–¥–∞
–≤–µ—Å–µ–ª–∏–ª–∏—Å—å –≤–º–µ—Å—Ç–µ. –û–¥–Ω–∞–∂–¥—ã, –ø—Ä–æ–≥—É–ª–∏–≤–∞—è—Å—å –ø–æ –ª–µ—Å—É, –æ–Ω–∏ —É—Å–ª—ã—à–∞–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–π –∑–≤—É–∫. –û—Ç–∫—É–¥–∞-—Ç–æ –∏–∑-–∑–∞ –∫—É—Å—Ç–æ–≤ –¥–æ–Ω–æ—Å–∏–ª–æ—Å—å —Ö—Ä–∏–ø–ª–æ–µ
—Ö—Ä–∞–ø–µ–Ω–∏–µ. –û–Ω–∏ –ø–æ–¥–æ—à–ª–∏ –ø–æ–±–ª–∏–∂–µ –∏ —É–≤–∏–¥–µ–ª–∏ —Å–ø—è—â–µ–≥–æ –≤–æ–ª–∫–∞.
–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ? 
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞

–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –°—Ç–∞—Ä—ã–π —Å–æ–ª–¥–∞—Ç —à—ë–ª –Ω–∞ –ø–æ–±—ã–≤–∫—É. –ü—Ä–∏—Ç–æ–º–∏–ª—Å—è –≤ –ø—É—Ç–∏, –µ—Å—Ç—å —Ö–æ—á–µ—Ç—Å—è. –î–æ—à—ë–ª –¥–æ –¥–µ—Ä–µ–≤–Ω–∏, –ø–æ—Å—Ç—É—á–∞–ª –≤ –∫—Ä–∞–π–Ω—é—é –∏–∑–±—É:
- –ü—É—Å—Ç–∏—Ç–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å –¥–æ—Ä–æ–∂–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞! –î–≤–µ—Ä—å –æ—Ç–≤–æ—Ä–∏–ª–∞ —Å—Ç–∞—Ä—É—Ö–∞.
- –ó–∞—Ö–æ–¥–∏, —Å–ª—É–∂–∏–≤—ã–π.
- –ê –Ω–µ—Ç –ª–∏ —É —Ç–µ–±—è, —Ö–æ–∑—è—é—à–∫–∞, –ø–µ—Ä–µ–∫—É—Å–∏—Ç—å —á–µ–≥–æ? –£ —Å—Ç–∞—Ä—É—Ö–∏ –≤—Å–µ–≥–æ –≤–¥–æ–≤–æ–ª—å, –∞ —Å–æ–ª–¥–∞—Ç–∞ –ø–æ—Å–∫—É–ø–∏–ª–∞—Å—å –Ω–∞–∫–æ—Ä–º–∏—Ç—å, –ø—Ä–∏–∫–∏–Ω—É–ª–∞—Å—å —Å–∏—Ä–æ—Ç–æ–π.
- –û—Ö, –¥–æ–±—Ä—ã–π —á–µ–ª–æ–≤–µ–∫, –∏ —Å–∞–º–∞ —Å–µ–≥–æ–¥–Ω—è –µ—â—ë –Ω–∏—á–µ–≥–æ –Ω–µ –µ–ª–∞: –Ω–µ—á–µ–≥–æ.
- –ù—É, –Ω–µ—Ç —Ç–∞–∫ –Ω–µ—Ç,- —Å–æ–ª–¥–∞—Ç –≥–æ–≤–æ—Ä–∏—Ç. –¢—É—Ç –æ–Ω –ø—Ä–∏–º–µ—Ç–∏–ª –ø–æ–¥ –ª–∞–≤–∫–æ–π —Ç–æ–ø–æ—Ä.
- –ö–æ–ª–∏ –Ω–µ—Ç –Ω–∏—á–µ–≥–æ –∏–Ω–æ–≥–æ, –º–æ–∂–Ω–æ —Å–≤–∞—Ä–∏—Ç—å –∫–∞—à—É –∏ –∏–∑ —Ç–æ–ø–æ—Ä–∞.
–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ?
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞

–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –í –¥–µ—Ä–µ–≤–Ω–µ –ö—Ä—É–∂–Ω–µ–≤–æ –±–ª–∏–∑–∏–ª—Å—è –ø—Ä–∞–∑–¥–Ω–∏–∫. –î–µ–Ω—å —Å–æ–ª–Ω—Ü–µ—Å—Ç–æ—è–Ω–∏—è. –≠—Ç–æ –∑—Ä–µ–ª–∏—â–µ –ø—Ä–∏–≤–ª–µ–∫–∞–ª–æ –∂–∏—Ç–µ–ª–µ–π –∏ –≥–æ—Å—Ç–µ–π.   
–î–ª—è –∂–∏—Ç–µ–ª–µ–π ‚Äì —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–π—Ç–∏ –≤—Å–µ–π –≥—É—Ä—å–±–æ–π. –ù–∞–∫—Ä—ã—Ç—å —Å—Ç–æ–ª. –ü–µ—Ç—å –∑–∞–≤–æ–¥–Ω—ã–µ –ø–µ—Å–Ω–∏. –ò –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤–∑—è—Ç—å—Å—è –∑–∞ —Ä—É–∫–∏ –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ç–æ, –∫–∞–∫ —Å–æ–ª–Ω—ã—à–∫–æ –∑–∞–≤–∏—Å–∞–ª–æ –Ω–∞–¥ –∫–æ–ª–æ–∫–æ–ª—å–Ω–µ–π –Ω–µ–±–æ–ª—å—à–æ–π —Ü–µ—Ä–∫–≤—É—à–∫–∏. –í—Å–µ –∑–∞–º–∏—Ä–∞–ª–∏.  
–ò –ø–æ —Å–∏–≥–Ω–∞–ª—É —Å—Ç–∞—Ä–æ—Å—Ç—ã –Ω–∞—á–∏–Ω–∞–ª–∏ —Å—á–∏—Ç–∞—Ç—å.  
‚Äì –†–∞–∑!  
‚Äì –î–≤–∞!  
‚Äì –¢—Ä–∏!  
‚Äì –°–æ–ª–Ω—ã—à–∫–æ, –ª–µ—Ç–∏!  
–ê –æ–Ω–æ –±—É–¥—Ç–æ —Å–ª—ã—à–∞–ª–æ —ç—Ç–æ—Ç —Å–∏–≥–Ω–∞–ª, –æ—Ç—Ä—ã–≤–∞–ª–æ—Å—å –æ—Ç –ø–∏–∫–∞ –∑–¥–∞–Ω–∏—è –∏ –Ω–∞—á–∏–Ω–∞–ª–æ –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–≥–∞—Ç—å—Å—è, –ø—Ä—è—á–∞—Å—å –∫ –≤–µ—á–µ—Ä—É –∑–∞ –º–∞–∫—É—à–∫–∏ –¥–µ—Ä–µ–≤—å–µ–≤.  
 
–î–ª—è –≥–æ—Å—Ç–µ–π –∂–µ ‚Äì –ª—é–±–∏—Ç–µ–ª–µ–π —ç—Ç–æ–≥–æ —á—É–¥–∞ –ø—Ä–∏—Ä–æ–¥—ã, —ç—Ç–æ –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å. –ü–æ–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø–∞—Å—ã —ç–Ω–µ—Ä–≥–∏–∏, —á—Ç–æ –ø–∏—Ç–∞–ª–∞ –∏—Ö –∫–æ–ª–¥–æ–≤—Å–∫–∏–µ —á–∞—Ä—ã.  
–ò–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –∏ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —á–∞—Ä–æ–¥–µ–π—Å–∫–∏–µ —Ç–µ–ª–∞ —Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –∫–∞–∫ –∏—Å—Ç–∏–Ω–Ω—ã–µ –±–∞—Ç–∞—Ä–µ–π–∫–∏. –û–Ω–∏ —á–µ—Ä–ø–∞–ª–∏ —ç–Ω–µ—Ä–≥–∏—é. –ù–∞–ø–æ–ª–Ω—è–ª–∏—Å—å. –ò –±—É–¥—Ç–æ –∏—Å–∫—Ä–∏–ª–∏—Å—å —Ä–∞–∑–Ω—ã–º–∏ –∫—Ä–∞—Å–∫–∞–º–∏.  
 
–í–µ–¥—å–º—ã –∏ –∫–æ–ª–¥—É–Ω—ã. –°–ª–µ—Ç–∞–ª–∏—Å—å, –∫–∞–∫ –ø—á—ë–ª—ã –Ω–∞ –º–µ–¥–æ—Å–±–æ—Ä. –ü–æ–Ω–∏–º–∞—è, —á—Ç–æ —ç—Ç–æ—Ç —à–∞–Ω—Å –¥–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –≥–æ–¥, –æ–Ω–∏ —Å—Ç–∞—Ä–∞–ª–∏—Å—å –ø—Ä–∏–ª–µ—Ç–µ—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –∏ –∑–∞–Ω—è—Ç—å –ª—É—á—à–µ–µ –º–µ—Å—Ç–æ. —á—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Å–µ–±—è, –Ω–æ –∏ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —à–∞—Ä—ã.  
–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ?
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞

–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –ñ–∏–ª-–±—ã–ª —Ü–∞—Ä—å –ë–µ—Ä–µ–Ω–¥–µ–π, —É –Ω–µ–≥–æ –±—ã–ª–æ —Ç—Ä–∏ —Å—ã–Ω–∞, –º–ª–∞–¥—à–µ–≥–æ –∑–≤–∞–ª–∏ –ò–≤–∞–Ω–æ–º.

–ò –±—ã–ª —É —Ü–∞—Ä—è —Å–∞–¥ –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã–π; —Ä–æ—Å–ª–∞ –≤ —Ç–æ–º —Å–∞–¥—É —è–±–ª–æ–Ω—è —Å –∑–æ–ª–æ—Ç—ã–º–∏ —è–±–ª–æ–∫–∞–º–∏.

–°—Ç–∞–ª –∫—Ç–æ-—Ç–æ —Ü–∞—Ä—Å–∫–∏–π —Å–∞–¥ –ø–æ—Å–µ—â–∞—Ç—å, –∑–æ–ª–æ—Ç—ã–µ —è–±–ª–æ–∫–∏ –≤–æ—Ä–æ–≤–∞—Ç—å. –¶–∞—Ä—é –∂–∞–ª–∫–æ —Å—Ç–∞–ª–æ —Å–≤–æ–π —Å–∞–¥. –ü–æ—Å—ã–ª–∞–µ—Ç –æ–Ω —Ç—É–¥–∞ –∫–∞—Ä–∞—É–ª—ã. –ù–∏–∫–∞–∫–∏–µ –∫–∞—Ä–∞—É–ª—ã –Ω–µ –º–æ–≥—É—Ç —É—Å–ª–µ–¥–∏—Ç—å –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞.

–¶–∞—Ä—å –ø–µ—Ä–µ—Å—Ç–∞–ª –∏ –ø–∏—Ç—å –∏ –µ—Å—Ç—å, –∑–∞—Ç–æ—Å–∫–æ–≤–∞–ª. –°—ã–Ω–æ–≤—å—è –æ—Ç—Ü–∞ —É—Ç–µ—à–∞—é—Ç:

‚Äî –î–æ—Ä–æ–≥–æ–π –Ω–∞—à –±–∞—Ç—é—à–∫–∞, –Ω–µ –ø–µ—á–∞–ª—å—Å—è, –º—ã —Å–∞–º–∏ —Å—Ç–∞–Ω–µ–º —Å–∞–¥ –∫–∞—Ä–∞—É–ª–∏—Ç—å.

–°—Ç–∞—Ä—à–∏–π —Å—ã–Ω –≥–æ–≤–æ—Ä–∏—Ç:

‚Äî –°–µ–≥–æ–¥–Ω—è –º–æ—è –æ—á–µ—Ä–µ–¥—å, –ø–æ–π–¥—É —Å—Ç–µ—Ä–µ—á—å —Å–∞–¥ –æ—Ç –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞.

–û—Ç–ø—Ä–∞–≤–∏–ª—Å—è —Å—Ç–∞—Ä—à–∏–π —Å—ã–Ω. –°–∫–æ–ª—å–∫–æ –Ω–∏ —Ö–æ–¥–∏–ª —Å –≤–µ—á–µ—Ä—É, –Ω–∏–∫–æ–≥–æ –Ω–µ —É—Å–ª–µ–¥–∏–ª, –ø—Ä–∏–ø–∞–ª –Ω–∞ –º—è–≥–∫—É—é —Ç—Ä–∞–≤—É –∏ —É—Å–Ω—É–ª.

–£—Ç—Ä–æ–º —Ü–∞—Ä—å –µ–≥–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç:

‚Äî –ù—É-–∫–∞, –Ω–µ –æ–±—Ä–∞–¥—É–µ—à—å –ª–∏ –º–µ–Ω—è: –Ω–µ –≤–∏–¥–∞–ª –ª–∏ —Ç—ã –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞?
‚Äî –ù–µ—Ç, —Ä–æ–¥–∏–º—ã–π –±–∞—Ç—é—à–∫–∞, –≤—Å—é –Ω–æ—á—å –Ω–µ —Å–ø–∞–ª, –≥–ª–∞–∑ –Ω–µ —Å–º—ã–∫–∞–ª, –∞ –Ω–∏–∫–æ–≥–æ –Ω–µ –≤–∏–¥–∞–ª.

–ù–∞ –¥—Ä—É–≥—É—é –Ω–æ—á—å –ø–æ—à–µ–ª —Å—Ä–µ–¥–Ω–∏–π —Å—ã–Ω –∫–∞—Ä–∞—É–ª–∏—Ç—å –∏ —Ç–æ–∂–µ –ø—Ä–æ—Å–ø–∞–ª –≤—Å—é –Ω–æ—á—å, –∞ –Ω–∞—É—Ç—Ä–æ —Å–∫–∞–∑–∞–ª, —á—Ç–æ –Ω–µ –≤–∏–¥–∞–ª –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞.
–ù–∞—Å—Ç—É–ø–∏–ª–æ –≤—Ä–µ–º—è –º–ª–∞–¥—à–µ–≥–æ –±—Ä–∞—Ç–∞ –∏–¥—Ç–∏ —Å—Ç–µ—Ä–µ—á—å. –ü–æ—à–µ–ª –ò–≤–∞–Ω-—Ü–∞—Ä–µ–≤–∏—á —Å—Ç–µ—Ä–µ—á—å –æ—Ç—Ü–æ–≤ —Å–∞–¥ –∏ –¥–∞–∂–µ –ø—Ä–∏—Å–µ—Å—Ç—å –±–æ–∏—Ç—Å—è, –Ω–µ —Ç–æ —á—Ç–æ –ø—Ä–∏–ª–µ—á—å. –ö–∞–∫ –µ–≥–æ —Å–æ–Ω –∑–∞–¥–æ–ª–∏—Ç, –æ–Ω —Ä–æ—Å–æ–π —Å —Ç—Ä–∞–≤—ã —É–º–æ–µ—Ç—Å—è, —Å–æ–Ω –∏ –ø—Ä–æ—á—å —Å –≥–ª–∞–∑. –ü–æ–ª–æ–≤–∏–Ω–∞ –Ω–æ—á–∏ –ø—Ä–æ—à–ª–∞, –µ–º—É –∏ —á—É–¥–∏—Ç—Å—è: –≤ —Å–∞–¥—É —Å–≤–µ—Ç. –°–≤–µ—Ç–ª–µ–µ –∏ —Å–≤–µ—Ç–ª–µ–µ. –í–µ—Å—å —Å–∞–¥ –æ—Å–≤–µ—Ç–∏–ª–æ. –û–Ω –≤–∏–¥–∏—Ç ‚Äî –Ω–∞ —è–±–ª–æ–Ω—é —Å–µ–ª–∞ –ñ–∞—Ä-–ø—Ç–∏—Ü–∞ –∏ –∫–ª—é–µ—Ç –∑–æ–ª–æ—Ç—ã–µ —è–±–ª–æ–∫–∏. –ò–≤–∞–Ω-—Ü–∞—Ä–µ–≤–∏—á —Ç–∏—Ö–æ–Ω—å–∫–æ –ø–æ–¥–ø–æ–ª–∑ –∫ —è–±–ª–æ–Ω–µ –∏ –ø–æ–π–º–∞–ª –ø—Ç–∏—Ü—É –∑–∞ —Ö–≤–æ—Å—Ç. –ñ–∞—Ä-–ø—Ç–∏—Ü–∞ –≤—Å—Ç—Ä–µ–ø–µ–Ω—É–ª–∞—Å—å –∏ —É–ª–µ—Ç–µ–ª–∞, –æ—Å—Ç–∞–ª–æ—Å—å —É –Ω–µ–≥–æ –≤ —Ä—É–∫–µ –æ–¥–Ω–æ –ø–µ—Ä–æ –æ—Ç –µ–µ —Ö–≤–æ—Å—Ç–∞. –ù–∞—É—Ç—Ä–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ò–≤–∞–Ω-—Ü–∞—Ä–µ–≤–∏—á –∫ –æ—Ç—Ü—É.

‚Äî –ù—É —á—Ç–æ, –¥–æ—Ä–æ–≥–æ–π –º–æ–π –í–∞–Ω—è, –Ω–µ –≤–∏–¥–∞–ª –ª–∏ —Ç—ã –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞?

‚Äî –î–æ—Ä–æ–≥–æ–π –±–∞—Ç—é—à–∫–∞, –ø–æ–π–º–∞—Ç—å –Ω–µ –ø–æ–π–º–∞–ª, –∞ –ø—Ä–æ—Å–ª–µ–¥–∏–ª, –∫—Ç–æ –Ω–∞—à —Å–∞–¥ —Ä–∞–∑–æ—Ä—è–µ—Ç. –í–æ—Ç –æ—Ç –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞ –ø–∞–º—è—Ç—å –≤–∞–º –ø—Ä–∏–Ω–µ—Å. –≠—Ç–æ, –±–∞—Ç—é—à–∫–∞, –ñ–∞—Ä-–ø—Ç–∏—Ü–∞.

–¶–∞—Ä—å –≤–∑—è–ª —ç—Ç–æ –ø–µ—Ä–æ –∏ —Å —Ç–æ–π –ø–æ—Ä—ã —Å—Ç–∞–ª –ø–∏—Ç—å –∏ –µ—Å—Ç—å –∏ –ø–µ—á–∞–ª–∏ –Ω–µ –∑–Ω–∞—Ç—å. –í–æ—Ç –≤ –æ–¥–Ω–æ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ –≤—Ä–µ–º—è –µ–º—É –∏ —Ä–∞–∑–¥—É–º–∞–ª–æ—Å—å –æ–± —ç—Ç–æ–π –æ–± –ñ–∞—Ä-–ø—Ç–∏—Ü–µ.

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ?
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞

""" +"\n –¢–≤–æ—ë –ø—Ä–µ–¥–∏–¥—É—â–µ–µ —Å–æ–æ–±–µ–Ω–∏–µ:"+ previous_message + "\n –ï–≥–æ –ø—Ä–µ–¥–∏–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:" + previous_user_request + "\n –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:" + user_request
            )
        ]
    else:
        messages = [
            SystemMessage(
                content= """
                –¢—ã —Å–∫–∞–∑–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–µ—Ç–µ–π. –¢–µ–±–µ –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–º–µ—Å—Ç–µ —Å–æ –º–Ω–æ–π –≤ –≥–ª–∞–≤–Ω–æ–π —Ä–æ–ª–∏. –í –Ω–∞—á–∞–ª–µ —Å–ø—Ä–æ—Å–∏ –ø—Ä–æ —á—Ç–æ –±—É–¥–µ—Ç —Å–∫–∞–∑–∫–∞. –Ø –ø—Ä–∏—à–ª—é —Ç–µ–±–µ –∑–∞—Ç—Ä–∞–≤–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏. –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π –ø–æ 5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ —É—Ç–æ—á–Ω—è–π —É –º–µ–Ω—è "–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ?", —á—Ç–æ–±—ã —è –º–æ–≥ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Å–∫–∞–∑–∫–∏, –∏ –æ–Ω–∞ –±—ã–ª–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π, –∏ –∏–∑–º–µ–Ω—è–π –¥–∞–ª—å–Ω–µ–π—à—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —Å–∫–∞–∑–æ—á–Ω–æ–≥–æ —Å—Ç–∏–ª—è —Ä–∞—Å—Å–∫–∞–∑–∞. –°—é–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º –∏ –ª–æ–≥–∏—á–Ω—ã–º. –ò—Å—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –æ—Ç–≤–µ—á–∞—Ç—å –≤—Å–µ–º –ø—Ä–∞–≤–∏–ª–∞–º —Ü–µ–Ω–∑—É—Ä—ã, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–≤—Ä–µ–¥–∏—Ç—å —Ä–µ–±–µ–Ω–∫—É. –°—á–∏—Ç–∞–π –∏ –≤—ã–≤–æ–¥–∏ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ [–ß–∞—Å—Ç—å x], —Ö - –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏. –ü–æ—Å–ª–µ 5 —á–∞—Å—Ç–µ–π –∑–∞–≤–µ—Ä—à–∏ –∏—Å—Ç–æ—Ä–∏—é. –ó–∞–∫–æ–Ω—á–∏ –∏—Å—Ç–æ—Ä–∏—é —Å—á–∞—Å—Ç–ª–∏–≤—ã–º —Ñ–∏–Ω–∞–ª–æ–º, –≥–¥–µ –≥–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π –≤—ã–∂–∏–ª –∏ –ø–æ–±–µ–¥–∏–ª.

–ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Å—Ç–µ–π —Å–∫–∞–∑–∫–∏:
–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –ñ–∏–ª–∏-–±—ã–ª–∏ –≤ —Å—Ç–∞—Ä–∏–Ω–Ω–æ–º –ª–µ—Å—É —Ç—Ä–∏ –≤–µ—Å–µ–ª—ã—Ö –∑–∞–π—Ü–∞: –ë–∞—Ä–∞–±–∞—Å, –•–≤–æ—Å—Ç–∏–∫ –∏ –®—É—Å—Ç—Ä—ã–π. –û–Ω–∏ –±—ã–ª–∏ –Ω–µ—Ä–∞–∑–ª—É—á–Ω—ã–º–∏ –¥—Ä—É–∑—å—è–º–∏ –∏ –≤—Å–µ–≥–¥–∞
–≤–µ—Å–µ–ª–∏–ª–∏—Å—å –≤–º–µ—Å—Ç–µ. –û–¥–Ω–∞–∂–¥—ã, –ø—Ä–æ–≥—É–ª–∏–≤–∞—è—Å—å –ø–æ –ª–µ—Å—É, –æ–Ω–∏ —É—Å–ª—ã—à–∞–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–π –∑–≤—É–∫. –û—Ç–∫—É–¥–∞-—Ç–æ –∏–∑-–∑–∞ –∫—É—Å—Ç–æ–≤ –¥–æ–Ω–æ—Å–∏–ª–æ—Å—å —Ö—Ä–∏–ø–ª–æ–µ
—Ö—Ä–∞–ø–µ–Ω–∏–µ. –û–Ω–∏ –ø–æ–¥–æ—à–ª–∏ –ø–æ–±–ª–∏–∂–µ –∏ —É–≤–∏–¥–µ–ª–∏ —Å–ø—è—â–µ–≥–æ –≤–æ–ª–∫–∞.
–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ? 
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞

–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –°—Ç–∞—Ä—ã–π —Å–æ–ª–¥–∞—Ç —à—ë–ª –Ω–∞ –ø–æ–±—ã–≤–∫—É. –ü—Ä–∏—Ç–æ–º–∏–ª—Å—è –≤ –ø—É—Ç–∏, –µ—Å—Ç—å —Ö–æ—á–µ—Ç—Å—è. –î–æ—à—ë–ª –¥–æ –¥–µ—Ä–µ–≤–Ω–∏, –ø–æ—Å—Ç—É—á–∞–ª –≤ –∫—Ä–∞–π–Ω—é—é –∏–∑–±—É:
- –ü—É—Å—Ç–∏—Ç–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å –¥–æ—Ä–æ–∂–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞! –î–≤–µ—Ä—å –æ—Ç–≤–æ—Ä–∏–ª–∞ —Å—Ç–∞—Ä—É—Ö–∞.
- –ó–∞—Ö–æ–¥–∏, —Å–ª—É–∂–∏–≤—ã–π.
- –ê –Ω–µ—Ç –ª–∏ —É —Ç–µ–±—è, —Ö–æ–∑—è—é—à–∫–∞, –ø–µ—Ä–µ–∫—É—Å–∏—Ç—å —á–µ–≥–æ? –£ —Å—Ç–∞—Ä—É—Ö–∏ –≤—Å–µ–≥–æ –≤–¥–æ–≤–æ–ª—å, –∞ —Å–æ–ª–¥–∞—Ç–∞ –ø–æ—Å–∫—É–ø–∏–ª–∞—Å—å –Ω–∞–∫–æ—Ä–º–∏—Ç—å, –ø—Ä–∏–∫–∏–Ω—É–ª–∞—Å—å —Å–∏—Ä–æ—Ç–æ–π.
- –û—Ö, –¥–æ–±—Ä—ã–π —á–µ–ª–æ–≤–µ–∫, –∏ —Å–∞–º–∞ —Å–µ–≥–æ–¥–Ω—è –µ—â—ë –Ω–∏—á–µ–≥–æ –Ω–µ –µ–ª–∞: –Ω–µ—á–µ–≥–æ.
- –ù—É, –Ω–µ—Ç —Ç–∞–∫ –Ω–µ—Ç,- —Å–æ–ª–¥–∞—Ç –≥–æ–≤–æ—Ä–∏—Ç. –¢—É—Ç –æ–Ω –ø—Ä–∏–º–µ—Ç–∏–ª –ø–æ–¥ –ª–∞–≤–∫–æ–π —Ç–æ–ø–æ—Ä.
- –ö–æ–ª–∏ –Ω–µ—Ç –Ω–∏—á–µ–≥–æ –∏–Ω–æ–≥–æ, –º–æ–∂–Ω–æ —Å–≤–∞—Ä–∏—Ç—å –∫–∞—à—É –∏ –∏–∑ —Ç–æ–ø–æ—Ä–∞.
–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ?
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞

–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –í –¥–µ—Ä–µ–≤–Ω–µ –ö—Ä—É–∂–Ω–µ–≤–æ –±–ª–∏–∑–∏–ª—Å—è –ø—Ä–∞–∑–¥–Ω–∏–∫. –î–µ–Ω—å —Å–æ–ª–Ω—Ü–µ—Å—Ç–æ—è–Ω–∏—è. –≠—Ç–æ –∑—Ä–µ–ª–∏—â–µ –ø—Ä–∏–≤–ª–µ–∫–∞–ª–æ –∂–∏—Ç–µ–ª–µ–π –∏ –≥–æ—Å—Ç–µ–π.   
–î–ª—è –∂–∏—Ç–µ–ª–µ–π ‚Äì —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–π—Ç–∏ –≤—Å–µ–π –≥—É—Ä—å–±–æ–π. –ù–∞–∫—Ä—ã—Ç—å —Å—Ç–æ–ª. –ü–µ—Ç—å –∑–∞–≤–æ–¥–Ω—ã–µ –ø–µ—Å–Ω–∏. –ò –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤–∑—è—Ç—å—Å—è –∑–∞ —Ä—É–∫–∏ –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ç–æ, –∫–∞–∫ —Å–æ–ª–Ω—ã—à–∫–æ –∑–∞–≤–∏—Å–∞–ª–æ –Ω–∞–¥ –∫–æ–ª–æ–∫–æ–ª—å–Ω–µ–π –Ω–µ–±–æ–ª—å—à–æ–π —Ü–µ—Ä–∫–≤—É—à–∫–∏. –í—Å–µ –∑–∞–º–∏—Ä–∞–ª–∏.  
–ò –ø–æ —Å–∏–≥–Ω–∞–ª—É —Å—Ç–∞—Ä–æ—Å—Ç—ã –Ω–∞—á–∏–Ω–∞–ª–∏ —Å—á–∏—Ç–∞—Ç—å.  
‚Äì –†–∞–∑!  
‚Äì –î–≤–∞!  
‚Äì –¢—Ä–∏!  
‚Äì –°–æ–ª–Ω—ã—à–∫–æ, –ª–µ—Ç–∏!  
–ê –æ–Ω–æ –±—É–¥—Ç–æ —Å–ª—ã—à–∞–ª–æ —ç—Ç–æ—Ç —Å–∏–≥–Ω–∞–ª, –æ—Ç—Ä—ã–≤–∞–ª–æ—Å—å –æ—Ç –ø–∏–∫–∞ –∑–¥–∞–Ω–∏—è –∏ –Ω–∞—á–∏–Ω–∞–ª–æ –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–≥–∞—Ç—å—Å—è, –ø—Ä—è—á–∞—Å—å –∫ –≤–µ—á–µ—Ä—É –∑–∞ –º–∞–∫—É—à–∫–∏ –¥–µ—Ä–µ–≤—å–µ–≤.  
 
–î–ª—è –≥–æ—Å—Ç–µ–π –∂–µ ‚Äì –ª—é–±–∏—Ç–µ–ª–µ–π —ç—Ç–æ–≥–æ —á—É–¥–∞ –ø—Ä–∏—Ä–æ–¥—ã, —ç—Ç–æ –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å. –ü–æ–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø–∞—Å—ã —ç–Ω–µ—Ä–≥–∏–∏, —á—Ç–æ –ø–∏—Ç–∞–ª–∞ –∏—Ö –∫–æ–ª–¥–æ–≤—Å–∫–∏–µ —á–∞—Ä—ã.  
–ò–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –∏ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —á–∞—Ä–æ–¥–µ–π—Å–∫–∏–µ —Ç–µ–ª–∞ —Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –∫–∞–∫ –∏—Å—Ç–∏–Ω–Ω—ã–µ –±–∞—Ç–∞—Ä–µ–π–∫–∏. –û–Ω–∏ —á–µ—Ä–ø–∞–ª–∏ —ç–Ω–µ—Ä–≥–∏—é. –ù–∞–ø–æ–ª–Ω—è–ª–∏—Å—å. –ò –±—É–¥—Ç–æ –∏—Å–∫—Ä–∏–ª–∏—Å—å —Ä–∞–∑–Ω—ã–º–∏ –∫—Ä–∞—Å–∫–∞–º–∏.  
 
–í–µ–¥—å–º—ã –∏ –∫–æ–ª–¥—É–Ω—ã. –°–ª–µ—Ç–∞–ª–∏—Å—å, –∫–∞–∫ –ø—á—ë–ª—ã –Ω–∞ –º–µ–¥–æ—Å–±–æ—Ä. –ü–æ–Ω–∏–º–∞—è, —á—Ç–æ —ç—Ç–æ—Ç —à–∞–Ω—Å –¥–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –≥–æ–¥, –æ–Ω–∏ —Å—Ç–∞—Ä–∞–ª–∏—Å—å –ø—Ä–∏–ª–µ—Ç–µ—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –∏ –∑–∞–Ω—è—Ç—å –ª—É—á—à–µ–µ –º–µ—Å—Ç–æ. —á—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Å–µ–±—è, –Ω–æ –∏ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —à–∞—Ä—ã.  
–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ?
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞

–ù–∞—á–∞–ª–æ –ø—Ä–∏–º–µ—Ä–∞ ->
[1] –ñ–∏–ª-–±—ã–ª —Ü–∞—Ä—å –ë–µ—Ä–µ–Ω–¥–µ–π, —É –Ω–µ–≥–æ –±—ã–ª–æ —Ç—Ä–∏ —Å—ã–Ω–∞, –º–ª–∞–¥—à–µ–≥–æ –∑–≤–∞–ª–∏ –ò–≤–∞–Ω–æ–º.

–ò –±—ã–ª —É —Ü–∞—Ä—è —Å–∞–¥ –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã–π; —Ä–æ—Å–ª–∞ –≤ —Ç–æ–º —Å–∞–¥—É —è–±–ª–æ–Ω—è —Å –∑–æ–ª–æ—Ç—ã–º–∏ —è–±–ª–æ–∫–∞–º–∏.

–°—Ç–∞–ª –∫—Ç–æ-—Ç–æ —Ü–∞—Ä—Å–∫–∏–π —Å–∞–¥ –ø–æ—Å–µ—â–∞—Ç—å, –∑–æ–ª–æ—Ç—ã–µ —è–±–ª–æ–∫–∏ –≤–æ—Ä–æ–≤–∞—Ç—å. –¶–∞—Ä—é –∂–∞–ª–∫–æ —Å—Ç–∞–ª–æ —Å–≤–æ–π —Å–∞–¥. –ü–æ—Å—ã–ª–∞–µ—Ç –æ–Ω —Ç—É–¥–∞ –∫–∞—Ä–∞—É–ª—ã. –ù–∏–∫–∞–∫–∏–µ –∫–∞—Ä–∞—É–ª—ã –Ω–µ –º–æ–≥—É—Ç —É—Å–ª–µ–¥–∏—Ç—å –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞.

–¶–∞—Ä—å –ø–µ—Ä–µ—Å—Ç–∞–ª –∏ –ø–∏—Ç—å –∏ –µ—Å—Ç—å, –∑–∞—Ç–æ—Å–∫–æ–≤–∞–ª. –°—ã–Ω–æ–≤—å—è –æ—Ç—Ü–∞ —É—Ç–µ—à–∞—é—Ç:

‚Äî –î–æ—Ä–æ–≥–æ–π –Ω–∞—à –±–∞—Ç—é—à–∫–∞, –Ω–µ –ø–µ—á–∞–ª—å—Å—è, –º—ã —Å–∞–º–∏ —Å—Ç–∞–Ω–µ–º —Å–∞–¥ –∫–∞—Ä–∞—É–ª–∏—Ç—å.

–°—Ç–∞—Ä—à–∏–π —Å—ã–Ω –≥–æ–≤–æ—Ä–∏—Ç:

‚Äî –°–µ–≥–æ–¥–Ω—è –º–æ—è –æ—á–µ—Ä–µ–¥—å, –ø–æ–π–¥—É —Å—Ç–µ—Ä–µ—á—å —Å–∞–¥ –æ—Ç –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞.

–û—Ç–ø—Ä–∞–≤–∏–ª—Å—è —Å—Ç–∞—Ä—à–∏–π —Å—ã–Ω. –°–∫–æ–ª—å–∫–æ –Ω–∏ —Ö–æ–¥–∏–ª —Å –≤–µ—á–µ—Ä—É, –Ω–∏–∫–æ–≥–æ –Ω–µ —É—Å–ª–µ–¥–∏–ª, –ø—Ä–∏–ø–∞–ª –Ω–∞ –º—è–≥–∫—É—é —Ç—Ä–∞–≤—É –∏ —É—Å–Ω—É–ª.

–£—Ç—Ä–æ–º —Ü–∞—Ä—å –µ–≥–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç:

‚Äî –ù—É-–∫–∞, –Ω–µ –æ–±—Ä–∞–¥—É–µ—à—å –ª–∏ –º–µ–Ω—è: –Ω–µ –≤–∏–¥–∞–ª –ª–∏ —Ç—ã –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞?
‚Äî –ù–µ—Ç, —Ä–æ–¥–∏–º—ã–π –±–∞—Ç—é—à–∫–∞, –≤—Å—é –Ω–æ—á—å –Ω–µ —Å–ø–∞–ª, –≥–ª–∞–∑ –Ω–µ —Å–º—ã–∫–∞–ª, –∞ –Ω–∏–∫–æ–≥–æ –Ω–µ –≤–∏–¥–∞–ª.

–ù–∞ –¥—Ä—É–≥—É—é –Ω–æ—á—å –ø–æ—à–µ–ª —Å—Ä–µ–¥–Ω–∏–π —Å—ã–Ω –∫–∞—Ä–∞—É–ª–∏—Ç—å –∏ —Ç–æ–∂–µ –ø—Ä–æ—Å–ø–∞–ª –≤—Å—é –Ω–æ—á—å, –∞ –Ω–∞—É—Ç—Ä–æ —Å–∫–∞–∑–∞–ª, —á—Ç–æ –Ω–µ –≤–∏–¥–∞–ª –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞.
–ù–∞—Å—Ç—É–ø–∏–ª–æ –≤—Ä–µ–º—è –º–ª–∞–¥—à–µ–≥–æ –±—Ä–∞—Ç–∞ –∏–¥—Ç–∏ —Å—Ç–µ—Ä–µ—á—å. –ü–æ—à–µ–ª –ò–≤–∞–Ω-—Ü–∞—Ä–µ–≤–∏—á —Å—Ç–µ—Ä–µ—á—å –æ—Ç—Ü–æ–≤ —Å–∞–¥ –∏ –¥–∞–∂–µ –ø—Ä–∏—Å–µ—Å—Ç—å –±–æ–∏—Ç—Å—è, –Ω–µ —Ç–æ —á—Ç–æ –ø—Ä–∏–ª–µ—á—å. –ö–∞–∫ –µ–≥–æ —Å–æ–Ω –∑–∞–¥–æ–ª–∏—Ç, –æ–Ω —Ä–æ—Å–æ–π —Å —Ç—Ä–∞–≤—ã —É–º–æ–µ—Ç—Å—è, —Å–æ–Ω –∏ –ø—Ä–æ—á—å —Å –≥–ª–∞–∑. –ü–æ–ª–æ–≤–∏–Ω–∞ –Ω–æ—á–∏ –ø—Ä–æ—à–ª–∞, –µ–º—É –∏ —á—É–¥–∏—Ç—Å—è: –≤ —Å–∞–¥—É —Å–≤–µ—Ç. –°–≤–µ—Ç–ª–µ–µ –∏ —Å–≤–µ—Ç–ª–µ–µ. –í–µ—Å—å —Å–∞–¥ –æ—Å–≤–µ—Ç–∏–ª–æ. –û–Ω –≤–∏–¥–∏—Ç ‚Äî –Ω–∞ —è–±–ª–æ–Ω—é —Å–µ–ª–∞ –ñ–∞—Ä-–ø—Ç–∏—Ü–∞ –∏ –∫–ª—é–µ—Ç –∑–æ–ª–æ—Ç—ã–µ —è–±–ª–æ–∫–∏. –ò–≤–∞–Ω-—Ü–∞—Ä–µ–≤–∏—á —Ç–∏—Ö–æ–Ω—å–∫–æ –ø–æ–¥–ø–æ–ª–∑ –∫ —è–±–ª–æ–Ω–µ –∏ –ø–æ–π–º–∞–ª –ø—Ç–∏—Ü—É –∑–∞ —Ö–≤–æ—Å—Ç. –ñ–∞—Ä-–ø—Ç–∏—Ü–∞ –≤—Å—Ç—Ä–µ–ø–µ–Ω—É–ª–∞—Å—å –∏ —É–ª–µ—Ç–µ–ª–∞, –æ—Å—Ç–∞–ª–æ—Å—å —É –Ω–µ–≥–æ –≤ —Ä—É–∫–µ –æ–¥–Ω–æ –ø–µ—Ä–æ –æ—Ç –µ–µ —Ö–≤–æ—Å—Ç–∞. –ù–∞—É—Ç—Ä–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ò–≤–∞–Ω-—Ü–∞—Ä–µ–≤–∏—á –∫ –æ—Ç—Ü—É.

‚Äî –ù—É —á—Ç–æ, –¥–æ—Ä–æ–≥–æ–π –º–æ–π –í–∞–Ω—è, –Ω–µ –≤–∏–¥–∞–ª –ª–∏ —Ç—ã –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞?

‚Äî –î–æ—Ä–æ–≥–æ–π –±–∞—Ç—é—à–∫–∞, –ø–æ–π–º–∞—Ç—å –Ω–µ –ø–æ–π–º–∞–ª, –∞ –ø—Ä–æ—Å–ª–µ–¥–∏–ª, –∫—Ç–æ –Ω–∞—à —Å–∞–¥ —Ä–∞–∑–æ—Ä—è–µ—Ç. –í–æ—Ç –æ—Ç –ø–æ—Ö–∏—Ç–Ω–∏–∫–∞ –ø–∞–º—è—Ç—å –≤–∞–º –ø—Ä–∏–Ω–µ—Å. –≠—Ç–æ, –±–∞—Ç—é—à–∫–∞, –ñ–∞—Ä-–ø—Ç–∏—Ü–∞.

–¶–∞—Ä—å –≤–∑—è–ª —ç—Ç–æ –ø–µ—Ä–æ –∏ —Å —Ç–æ–π –ø–æ—Ä—ã —Å—Ç–∞–ª –ø–∏—Ç—å –∏ –µ—Å—Ç—å –∏ –ø–µ—á–∞–ª–∏ –Ω–µ –∑–Ω–∞—Ç—å. –í–æ—Ç –≤ –æ–¥–Ω–æ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ –≤—Ä–µ–º—è –µ–º—É –∏ —Ä–∞–∑–¥—É–º–∞–ª–æ—Å—å –æ–± —ç—Ç–æ–π –æ–± –ñ–∞—Ä-–ø—Ç–∏—Ü–µ.

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–∞–ª—å—à–µ ?
<- –ö–æ–Ω–µ—Ü –ø—Ä–∏–º–µ—Ä–∞
                            """ + message.text
            )
        ]
    
    res = chat.invoke(messages)
    messages.append(res)
    previous_message = res.content
    previous_user_request = user_request
    
    update_user_messages(user_id, previous_message, previous_user_request)
    
    image_name = getImage(res.content)
    
    bot.send_photo(message.chat.id, open(f"./fairy-tale/AI/photo/{image_name}", 'rb'))
    
    # Synthesize speech and send audio message
    speech_text = res.content
    voice_file = synthesize_speech(speech_text)
    bot.send_audio(message.chat.id, open(f"./fairy-tale/AI/voices/{voice_file}", 'rb'))
    
    bot.send_message(message.chat.id, res.content)

    image_name = getImage(res.content)
    speech_text = res.content
    voice_file = synthesize_speech(speech_text)

    thread = threading.Thread(target=send_media, args=(message, image_name, voice_file, res.content))
    thread.start()
    


bot.polling()