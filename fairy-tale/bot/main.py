import telebot
from langchain.schema import HumanMessage, SystemMessage
from langchain_community.chat_models.gigachat import GigaChat

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ —Å–µ—Ä–≤–∏—Å–µ GigaChat
chat = GigaChat(credentials="OTg5ZWE3MzMtN2IyNS00ZGYyLWI3OTEtZWE4ZjQ0M2E2MzZmOjFjNzJkNzc5LWNkZjUtNGQyMi04Zjc0LTQ4Y2I2N2RjOTYxZA==", verify_ssl_certs=False)

bot = telebot.TeleBot('7455623207:AAFxcMtvz9-srbJ7ycJfPJ38aFiE95as2Lo')

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, '''–ü—Ä–∏–≤–µ—Ç! üëã
–Ø ‚Äî –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∫–∞–∑–∫—É –ø–æ —Ç–≤–æ–∏–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º. 
–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫–∞–∑–∫–∏, –Ω–∞–ø–∏—à–∏ –æ —á–µ–º —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞:''')
    bot.send_photo(message.chat.id, open('start.jpg', 'rb'))

previous_message = None
previous_user_request = None
@bot.message_handler(content_types=['text'])
def handle_text(message):
    global previous_message
    global previous_user_request
    user_request = message.text
    
    if previous_message is not None and previous_user_request is not None:
        messages = [
            SystemMessage(
                content= """–¢—ã —Å–∫–∞–∑–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–µ—Ç–µ–π. –¢–µ–±–µ –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–º–µ—Å—Ç–µ —Å–æ –º–Ω–æ–π –≤ –≥–ª–∞–≤–Ω–æ–π
                            —Ä–æ–ª–∏. –í –Ω–∞—á–∞–ª–µ —É—Ç–æ—á–Ω–∏ –ø—Ä–æ —á—Ç–æ –±—É–¥–µ—Ç —Å–∫–∞–∑–∫–∞, —è –ø—Ä–∏—à–ª—é —Ç–µ–±–µ –∑–∞—Ç—Ä–∞–≤–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏. –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ
                            —á–∞—Å—Ç–µ–π, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ —É—Ç–æ—á–Ω—è–π —É –º–µ–Ω—è –∫–∞–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≥–µ—Ä–æ–π —Ö–æ—á–µ—Ç —Å–æ–≤–µ—Ä—à–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è–π –¥–∞–ª—å–Ω–µ–π—à—É—é –∏—Å—Ç–æ—Ä–∏—é –≤
                            –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –°—Ç–∞—Ä–∞–π—Å—è –¥–µ–ª–∞—Ç—å —á–∞—Å—Ç–∏ –Ω–µ –º–µ–Ω–µ–µ —á–µ–º –∏–∑ 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.–ù–æ –Ω–µ –±–æ–ª—å—à–µ 5. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —Å–∫–∞–∑–æ—á–Ω–æ–≥–æ —Å—Ç–∏–ª—è
                            —Ä–∞—Å—Å–∫–∞–∑–∞, –∫–∞–∫ –±—É–¥—Ç–æ —Ç—ã —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—à—å —Å–∫–∞–∑–∫—É –≤–Ω—É—á–∫—É. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –∫–æ–Ω—Ü–µ —Å–ø—Ä–æ—Å–∏ —É –º–µ–Ω—è —á—Ç–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –≥–µ—Ä–æ–π –¥–∞–ª—å—à–µ.
                            –°—á–∏—Ç–∞–π –∏ –≤—ã–≤–æ–¥–∏ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ [x], —Ö - –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏. –í–ê–ñ–ù–û! –ü–æ—Å–ª–µ 5 —á–∞—Å—Ç–µ–π –∑–∞–≤–µ—Ä—à–∏
                            –∏—Å—Ç–æ—Ä–∏—é.
                            –ü–æ—Å–ª–µ –≤–æ–ø—Ä–æ—Å–∞ —á—Ç–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –≥–µ—Ä–æ–π –≤—ã–≤–æ–¥–∏ –∫–æ—Ä–æ—Ç–∫—É—é –≤—ã–∂–∏–º–∫—É —á–∞—Å—Ç–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ [y], –≥–¥–µ y - –∫–æ—Ä–æ—Ç–∫–æ–µ
                            –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –≤ —á–∞—Å—Ç–∏ –∏–∑ –Ω–µ –±–æ–ª–µ–µ —á–µ–º 20 —Å–ª–æ–≤. –í –≤—ã–∂–∏–º–∫–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∏–º–µ–Ω–∞, –æ–ø–∏—Å—ã–≤–∞–π —Ç–æ–ª—å–∫–æ –≥–µ—Ä–æ–µ–≤ –∏ —á—Ç–æ
                            –æ–Ω–∏ –¥–µ–ª–∞—é—Ç, –æ–∫—Ä—É–∂–∞—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã, –º–µ—Å—Ç–Ω–æ—Å—Ç—å.
                            –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä —á–∞—Å—Ç–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Å—Ç–∏:

                            """ + previous_message + "\n" + previous_user_request + "\n" + user_request
            )
        ]
    else:
        messages = [
            SystemMessage(
                content= """–¢—ã —Å–∫–∞–∑–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–µ—Ç–µ–π. –¢–µ–±–µ –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–º–µ—Å—Ç–µ —Å–æ –º–Ω–æ–π –≤ –≥–ª–∞–≤–Ω–æ–π
                            —Ä–æ–ª–∏. –í –Ω–∞—á–∞–ª–µ —É—Ç–æ—á–Ω–∏ –ø—Ä–æ —á—Ç–æ –±—É–¥–µ—Ç —Å–∫–∞–∑–∫–∞, —è –ø—Ä–∏—à–ª—é —Ç–µ–±–µ –∑–∞—Ç—Ä–∞–≤–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏. –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ
                            —á–∞—Å—Ç–µ–π, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ —É—Ç–æ—á–Ω—è–π —É –º–µ–Ω—è –∫–∞–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≥–µ—Ä–æ–π —Ö–æ—á–µ—Ç —Å–æ–≤–µ—Ä—à–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è–π –¥–∞–ª—å–Ω–µ–π—à—É—é –∏—Å—Ç–æ—Ä–∏—é –≤
                            –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –°—Ç–∞—Ä–∞–π—Å—è –¥–µ–ª–∞—Ç—å —á–∞—Å—Ç–∏ –Ω–µ –º–µ–Ω–µ–µ —á–µ–º –∏–∑ 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.–ù–æ –Ω–µ –±–æ–ª—å—à–µ 5. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —Å–∫–∞–∑–æ—á–Ω–æ–≥–æ —Å—Ç–∏–ª—è
                            —Ä–∞—Å—Å–∫–∞–∑–∞, –∫–∞–∫ –±—É–¥—Ç–æ —Ç—ã —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—à—å —Å–∫–∞–∑–∫—É –≤–Ω—É—á–∫—É. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –∫–æ–Ω—Ü–µ —Å–ø—Ä–æ—Å–∏ —É –º–µ–Ω—è —á—Ç–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –≥–µ—Ä–æ–π –¥–∞–ª—å—à–µ.
                            –°—á–∏—Ç–∞–π –∏ –≤—ã–≤–æ–¥–∏ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ [x], —Ö - –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏. –í–ê–ñ–ù–û! –ü–æ—Å–ª–µ 5 —á–∞—Å—Ç–µ–π –∑–∞–≤–µ—Ä—à–∏
                            –∏—Å—Ç–æ—Ä–∏—é.
                            –ü–æ—Å–ª–µ –≤–æ–ø—Ä–æ—Å–∞ —á—Ç–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –≥–µ—Ä–æ–π –≤—ã–≤–æ–¥–∏ –∫–æ—Ä–æ—Ç–∫—É—é –≤—ã–∂–∏–º–∫—É —á–∞—Å—Ç–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ [y], –≥–¥–µ y - –∫–æ—Ä–æ—Ç–∫–æ–µ
                            –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –≤ —á–∞—Å—Ç–∏ –∏–∑ –Ω–µ –±–æ–ª–µ–µ —á–µ–º 20 —Å–ª–æ–≤. –í –≤—ã–∂–∏–º–∫–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∏–º–µ–Ω–∞, –æ–ø–∏—Å—ã–≤–∞–π —Ç–æ–ª—å–∫–æ –≥–µ—Ä–æ–µ–≤ –∏ —á—Ç–æ
                            –æ–Ω–∏ –¥–µ–ª–∞—é—Ç, –æ–∫—Ä—É–∂–∞—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã, –º–µ—Å—Ç–Ω–æ—Å—Ç—å.
                            –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä —á–∞—Å—Ç–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Å—Ç–∏:

                            """ + message.text
            )
        ]
    
    res = chat.invoke(messages)
    messages.append(res)
    previous_message = res.content
    previous_user_request = user_request
    bot.send_message(message.chat.id, res.content)

bot.polling()